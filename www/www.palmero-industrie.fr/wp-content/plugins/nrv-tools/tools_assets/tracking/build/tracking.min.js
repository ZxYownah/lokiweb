const NrvTags="NrvTags",NrvTagsBrevo="NRVTAGS";function addParam(e,a,t){let r=new Date;return{time:t||r.getTime(),key:e,value:a}}function mergeOldParams(e){let a=getParamsFromLocalStorage(),t=[];return a&&a.length>0&&a.forEach(e=>{t.push(addParam(e.key,e.value,e.time))}),e.forEach(e=>{let a=e.key;if(t.find(e=>e.key===a)){let r=t.findIndex(e=>e.key===a);t[r]=addParam(e.key,e.value)}t.find(e=>e.key===a)||t.push(addParam(e.key,e.value))}),t}function urlScan(){let e=[],a=new URLSearchParams(window.location.search);["gclid","utm_id","utm_source"].forEach(t=>{a.has(t)&&e.push(addParam(t,a.get(t)))}),e.length>0&&saveParamsToLocalStorage(e=mergeOldParams(e))}function cookieScan(){let e=(document.cookie||"").split(";");if(0===e.length)return;const a=e.reduce((e,a)=>{const t=a.split("=");if(t.length<2||!a.trim())return e;const r=t.shift().trim(),o=t.join("=").trim();return e[r]=o,e},{});let t=[];["_fbc","_fbp"].forEach(e=>{a[e]&&t.push(addParam(e,a[e]))}),t.length>0&&(t=mergeOldParams(t),console.log(t),saveParamsToLocalStorage(t))}function saveParamsToLocalStorage(e){localStorage.setItem(NrvTags,JSON.stringify(e))}function getParamsFromLocalStorage(){let e=localStorage.getItem(NrvTags);if(e&&""!==e){let a=[],t=JSON.parse(e),r=(new Date).getTime();return t&&t.length>0&&t.forEach(e=>{let t=Math.abs(r-e.time)/36e5;r>=e.time&&t<720&&a.push(e)}),a}return null}function createInput(e,a){const t=document.createElement("input");t.type="hidden",t.name=NrvTags+"[]",t.value=a.value,e.appendChild(t)}function assignParams(e){let a=getParamsFromLocalStorage();a&&a.length>0&&a.forEach(a=>{createInput(e,a)})}function findInput(e,a){const t=e.querySelectorAll("input[name='"+NrvTagsBrevo+"']");if(t.length>0)for(let e=0;e<t.length;e++)!function(e,a){e.value=a}(t[e],a)}function assignValue(e){let a=getParamsFromLocalStorage();if(a&&a.length>0){let t=[];a.forEach(e=>{t.push(e.value)}),t.length>0&&findInput(e,t.join(","))}}function checkLocalStorage(){let e=getParamsFromLocalStorage();if(e&&e.length>0){let a=[];e.forEach(e=>{a.push(addParam(e.key,e.value,e.time))}),a.length>0&&saveParamsToLocalStorage(a)}else localStorage.removeItem(NrvTags)}function findParams(e){return document.getElementsByName(e).length>0}function setValueToForm(e){let a=e.id;findParams(NrvTagsBrevo)&&a.startsWith("sib_signup")&&assignValue(e),a.startsWith("sib_signup")||assignParams(e)}function assignFormsParams(){const e=document.querySelectorAll("form");e&&e.length>0&&e.forEach((e,a)=>{setValueToForm(e)})}try{checkLocalStorage()}catch(e){console.error(e)}try{urlScan(),cookieScan()}catch(e){console.error(e)}try{assignFormsParams()}catch(e){console.error(e)}
